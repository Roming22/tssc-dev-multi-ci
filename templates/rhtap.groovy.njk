{%- include "do-not-edit.njk" -%}

def info(message) {
    echo "INFO: ${message}"
}

def install_script (scriptname) {
    echo ("Loading libraryResource(${scriptname})")
    contents = libraryResource( scriptname )
    writeFile(file:  "rhtap/${scriptname}"  , text: contents)
    sh "chmod +x rhtap/${scriptname}"
}

def run_script (scriptname) {
    // load common utilities across all tasks
    install_script ("common.sh")
    install_script ("verify-deps-exist")

    if (scriptname == 'buildah-rhtap.sh') {
      // Called from buildah-rhtap.sh
      install_script ('merge-sboms.sh')
    }

    install_script (scriptname)
    sh "rhtap/${scriptname}"
}

{% for step in (build_steps | concat(gitops_steps)) -%}
{%- for substep in step.substeps -%}
def {{ substep | replace("-", "_") }}( ) {
    run_script ('{{ substep }}.sh')
}

{% endfor -%}
{%- endfor -%}
